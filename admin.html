<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#f97316">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="MenuCraft Admin">
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iMjAiIGZpbGw9IiNmOTczMTYiLz4KPHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHg9IjUwIiB5PSI1MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIj4KPHBhdGggZD0iTTMgN1YxN0gyMVY3SDNaTTE5IDlINVYxNUgxOVY5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTcgMTFIMTdWMTNIN1YxMVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo8L3N2Zz4K">


    <title>MenuCraft Admin - Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Load dependencies -->
    <script src="config/firebase-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/firebase-service.js"></script>
    <script src="js/components/shared-components.js"></script>
    <script src="js/components/category-management.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { getRestaurantInfo, DEFAULT_CATEGORIES, formatCurrency, formatDate, EmptyState, LoadingSpinner, ErrorMessage, Icons } = window.MenuCraftUtils;
        const { MenuItemForm } = window.MenuCraftComponents;
        const CategoryManagement = window.CategoryManagement;

        // Admin Panel Component
        const AdminPanel = () => {
            const [restaurantInfo, setRestaurantInfo] = useState(null);
            const [firebaseService, setFirebaseService] = useState(null);
            const [menuItems, setMenuItems] = useState([]);
            const [orders, setOrders] = useState([]);
            const [categories, setCategories] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [activeTab, setActiveTab] = useState('menu');

            // Initialize
            useEffect(() => {
                const restaurant = getRestaurantInfo();
                setRestaurantInfo(restaurant);
                setFirebaseService(new window.FirebaseService());
            }, []);

            // Load data
            useEffect(() => {
                if (firebaseService) {
                    loadData();
                }
            }, [firebaseService]);

            const loadData = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    const [itemsData, ordersData, categoriesData] = await Promise.all([
                        firebaseService.getMenuItems(),
                        firebaseService.getOrders(20),
                        firebaseService.getCategories()
                    ]);
                    setMenuItems(itemsData);
                    setOrders(ordersData);
                    setCategories(categoriesData);
                } catch (error) {
                    console.error('Error loading data:', error);
                    setError('Failed to load data. Please try again.');
                } finally {
                    setLoading(false);
                }
            };




const PWANotifications = {
  init() {
    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then((registration) => {
          console.log('SW registered:', registration);
          this.setupPushNotifications(registration);
        })
        .catch((error) => {
          console.log('SW registration failed:', error);
        });
    }

    // Show install prompt
    this.showInstallPrompt();
    
    // Setup real-time order monitoring
    this.setupOrderMonitoring();
  },

  async setupPushNotifications(registration) {
    // Request notification permission
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      console.log('Notification permission granted');
    }
  },

  showInstallPrompt() {
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Show custom install button
      const installBtn = document.createElement('button');
      installBtn.textContent = '📱 Install App';
      installBtn.className = 'fixed bottom-20 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-600 z-50';
      installBtn.onclick = async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log('Install prompt outcome:', outcome);
          deferredPrompt = null;
          installBtn.remove();
        }
      };
      document.body.appendChild(installBtn);
      
      // Auto-remove after 10 seconds
      setTimeout(() => {
        if (installBtn.parentNode) {
          installBtn.remove();
        }
      }, 10000);
    });
  },

  setupOrderMonitoring() {
    if (!window.db) return;

    // Listen for new orders
    window.db.collection('orders')
      .where('status', '==', 'pending')
      .orderBy('createdAt', 'desc')
      .onSnapshot((snapshot) => {
        snapshot.docChanges().forEach((change) => {
          if (change.type === 'added') {
            const order = change.doc.data();
            this.showOrderNotification(order);
          }
        });
      });
  },

  showOrderNotification(order) {
    // Browser notification
    if (Notification.permission === 'granted') {
      const notification = new Notification('🔔 New Order!', {
        body: `From: ${order.customerInfo?.name}\nTotal: $${order.total}`,
        icon: '/icon-192.png',
        badge: '/badge-72.png',
        vibrate: [200, 100, 200],
        requireInteraction: true,
        actions: [
          { action: 'view', title: 'View Order' },
          { action: 'dismiss', title: 'Dismiss' }
        ]
      });

      notification.onclick = () => {
        window.focus();
        // Switch to orders tab if function exists
        if (window.setActiveTab) {
          window.setActiveTab('orders');
        }
        notification.close();
      };
    }

    // Play notification sound
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LNeSUGLIHO8diJOQgZZ7zs559NEAxPqOPwtmMcBjiS1/LNeSUGLIHO8tiJOQgZZ7vs559NEAxPp+PwtmMcBjmS1/LNeSUGLIHO8tiJOQgZZ7zs559NEAxPp+PwtmMcBzmS1/LNeSUGLIHO8tiJOQgZZ7zs559NEAxPp+PwtmMcBzmS1/LNeSUGLIHO8tiJOQgZZ7zs559N');
    audio.play().catch(() => {}); // Ignore if audio fails

    // Visual indicator in title
    const originalTitle = document.title;
    document.title = '🔔 New Order! - MenuCraft Admin';
    setTimeout(() => {
      document.title = originalTitle;
    }, 5000);
  }
};






            const handleAddItem = async (itemData) => {
                try {
                    await firebaseService.addMenuItem(itemData);
                    setShowAddForm(false);
                    await loadData();
                } catch (error) {
                    console.error('Error adding item:', error);
                    throw error;
                }
            };

            const handleUpdateItem = async (id, updates) => {
                try {
                    await firebaseService.updateMenuItem(id, updates);
                    setEditingItem(null);
                    await loadData();
                } catch (error) {
                    console.error('Error updating item:', error);
                    throw error;
                }
            };

            const handleDeleteItem = async (id) => {
                if (confirm('Are you sure you want to delete this item?')) {
                    try {
                        await firebaseService.deleteMenuItem(id);
                        await loadData();
                    } catch (error) {
                        console.error('Error deleting item:', error);
                        alert('Error deleting item. Please try again.');
                    }
                }
            };

            const toggleStock = async (item) => {
                try {
                    await firebaseService.toggleItemStock(item.id, !item.inStock);
                    await loadData();
                } catch (error) {
                    console.error('Error toggling stock:', error);
                    alert('Error updating stock status. Please try again.');
                }
            };

            const updateOrderStatus = async (orderId, status) => {
                try {
                    await firebaseService.updateOrderStatus(orderId, status);
                    await loadData();
                } catch (error) {
                    console.error('Error updating order status:', error);
                    alert('Error updating order status. Please try again.');
                }
            };

            const handleCategoriesChange = (newCategories) => {
                setCategories(newCategories);
            };

            if (loading) {
                return React.createElement('div', { 
                    className: 'min-h-screen flex items-center justify-center bg-gray-100' 
                },
                    React.createElement('div', { className: 'text-center' },
                        React.createElement(LoadingSpinner, { size: 48 }),
                        React.createElement('p', { className: 'text-gray-600 mt-4' }, 'Loading admin dashboard...')
                    )
                );
            }

            return React.createElement('div', { className: 'min-h-screen bg-gray-100' },
                // Header
                React.createElement('div', { className: 'bg-white shadow-sm' },
                    React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-6' },
                        React.createElement('div', { className: 'flex flex-col md:flex-row justify-between items-start md:items-center gap-4' },
                            React.createElement('div', null,
                                React.createElement('h1', { className: 'text-3xl font-bold text-gray-800' }, 'MenuCraft Admin'),
                                React.createElement('p', { className: 'text-gray-600' }, 
                                    `Managing: ${restaurantInfo?.displayName || 'Restaurant'}`
                                )
                            ),
                            React.createElement('div', { className: 'flex gap-3' },
                                React.createElement('a', {
                                    href: 'index.html',
                                    className: 'bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors'
                                }, 'View Menu'),
                                React.createElement('button', {
                                    onClick: () => setShowAddForm(true),
                                    className: 'bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors'
                                }, '+ Add Menu Item')
                            )
                        )
                    )
                ),

                // Navigation Tabs
                React.createElement('div', { className: 'bg-white border-b' },
                    React.createElement('div', { className: 'max-w-7xl mx-auto px-4' },
                        React.createElement('div', { className: 'flex space-x-8' },
                            React.createElement('button', {
                                onClick: () => setActiveTab('menu'),
                                className: `py-4 px-1 border-b-2 font-medium text-sm ${
                                    activeTab === 'menu' 
                                        ? 'border-orange-500 text-orange-600' 
                                        : 'border-transparent text-gray-500 hover:text-gray-700'
                                }`
                            }, `Menu Items (${menuItems.length})`),
                            React.createElement('button', {
                                onClick: () => setActiveTab('orders'),
                                className: `py-4 px-1 border-b-2 font-medium text-sm ${
                                    activeTab === 'orders' 
                                        ? 'border-orange-500 text-orange-600' 
                                        : 'border-transparent text-gray-500 hover:text-gray-700'
                                }`
                            }, `Recent Orders (${orders.length})`),
                            React.createElement('button', {
                                onClick: () => setActiveTab('categories'),
                                className: `py-4 px-1 border-b-2 font-medium text-sm ${
                                    activeTab === 'categories' 
                                        ? 'border-orange-500 text-orange-600' 
                                        : 'border-transparent text-gray-500 hover:text-gray-700'
                                }`
                            }, `Categories (${categories.length})`)
                        )
                    )
                ),

                // Main Content
                React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-6' },
                    error ? React.createElement(ErrorMessage, {
                        message: error,
                        onRetry: loadData
                    }) :

                    activeTab === 'menu' ? 
                        // Menu Items Tab
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-sm' },
                            React.createElement('div', { className: 'p-6' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                    React.createElement('h2', { className: 'text-xl font-semibold' }, 'Menu Items'),
                                    React.createElement('span', { className: 'text-gray-500' }, 
                                        `${menuItems.length} total items`
                                    )
                                ),
                                
                                menuItems.length === 0 ? 
                                    React.createElement(EmptyState, {
                                        title: 'No Menu Items',
                                        message: 'Start building your menu by adding your first item.',
                                        actionText: 'Add First Item',
                                        onAction: () => setShowAddForm(true)
                                    }) :
                                    React.createElement('div', { className: 'overflow-x-auto' },
                                        React.createElement('table', { className: 'w-full' },
                                            React.createElement('thead', null,
                                                React.createElement('tr', { className: 'border-b' },
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Item'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Category'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Price'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Status'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Actions')
                                                )
                                            ),
                                            React.createElement('tbody', null,
                                                menuItems.map(item =>
                                                    React.createElement('tr', { 
                                                        key: item.id, 
                                                        className: 'border-b hover:bg-gray-50' 
                                                    },
                                                        React.createElement('td', { className: 'py-4 px-4' },
                                                            React.createElement('div', null,
                                                                React.createElement('div', { 
                                                                    className: 'font-medium flex items-center gap-2' 
                                                                }, 
                                                                    item.name,
                                                                    item.vegetarian && React.createElement('span', { 
                                                                        className: 'text-green-600' 
                                                                    }, '🌱'),
                                                                    item.spicy && React.createElement('span', { 
                                                                        className: 'text-red-600' 
                                                                    }, '🌶️')
                                                                ),
                                                                React.createElement('div', { 
                                                                    className: 'text-sm text-gray-500 truncate max-w-xs' 
                                                                }, item.description)
                                                            )
                                                        ),
                                                        React.createElement('td', { 
                                                            className: 'py-4 px-4 capitalize' 
                                                        }, 
                                                            categories.find(cat => cat.id === item.category)?.name || 
                                                            DEFAULT_CATEGORIES.find(cat => cat.id === item.category)?.name || 
                                                            item.category
                                                        ),
                                                        React.createElement('td', { 
                                                            className: 'py-4 px-4 font-medium' 
                                                        }, formatCurrency(item.price)),
                                                        React.createElement('td', { className: 'py-4 px-4' },
                                                            React.createElement('button', {
                                                                onClick: () => toggleStock(item),
                                                                className: `px-3 py-1 rounded-full text-xs font-medium ${
                                                                    item.inStock 
                                                                        ? 'bg-green-100 text-green-800 hover:bg-green-200' 
                                                                        : 'bg-red-100 text-red-800 hover:bg-red-200'
                                                                }`
                                                            }, item.inStock ? 'In Stock' : 'Out of Stock')
                                                        ),
                                                        React.createElement('td', { className: 'py-4 px-4' },
                                                            React.createElement('div', { className: 'flex gap-2' },
                                                                React.createElement('button', {
                                                                    onClick: () => setEditingItem(item),
                                                                    className: 'text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-100 rounded',
                                                                    title: 'Edit item'
                                                                }, React.createElement(Icons.Edit, { size: 16 })),
                                                                React.createElement('button', {
                                                                    onClick: () => handleDeleteItem(item.id),
                                                                    className: 'text-red-600 hover:text-red-800 p-1 hover:bg-red-100 rounded',
                                                                    title: 'Delete item'
                                                                }, React.createElement(Icons.Trash2, { size: 16 }))
                                                            )
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                            )
                        ) :

                        activeTab === 'orders' ?
                        // Orders Tab
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-sm' },
                            React.createElement('div', { className: 'p-6' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                    React.createElement('h2', { className: 'text-xl font-semibold' }, 'Recent Orders'),
                                    React.createElement('span', { className: 'text-gray-500' }, 
                                        `${orders.length} recent orders`
                                    )
                                ),
                                
                                orders.length === 0 ? 
                                    React.createElement(EmptyState, {
                                        title: 'No Orders Yet',
                                        message: 'Orders will appear here when customers start placing them.',
                                        actionText: null,
                                        onAction: null
                                    }) :
                                    React.createElement('div', { className: 'space-y-4' },
                                        orders.map(order =>
                                            React.createElement('div', {
                                                key: order.id,
                                                className: 'border rounded-lg p-4 hover:shadow-md transition-shadow'
                                            },
                                                React.createElement('div', { 
                                                    className: 'flex justify-between items-start mb-3' 
                                                },
                                                    React.createElement('div', null,
                                                        React.createElement('h3', { 
                                                            className: 'font-semibold' 
                                                        }, order.orderNumber || order.id),
                                                        React.createElement('p', { 
                                                            className: 'text-sm text-gray-600' 
                                                        }, order.customerInfo?.name),
                                                        React.createElement('p', { 
                                                            className: 'text-xs text-gray-500' 
                                                        }, formatDate(order.createdAt))
                                                    ),
                                                    React.createElement('div', { className: 'text-right' },
                                                        React.createElement('div', { 
                                                            className: 'font-semibold text-lg' 
                                                        }, formatCurrency(order.total)),
                                                        React.createElement('select', {
                                                            value: order.status,
                                                            onChange: (e) => updateOrderStatus(order.id, e.target.value),
                                                            className: `text-xs px-2 py-1 rounded border ${
                                                                order.status === 'pending' ? 'bg-yellow-50 border-yellow-200 text-yellow-800' :
                                                                order.status === 'confirmed' ? 'bg-blue-50 border-blue-200 text-blue-800' :
                                                                order.status === 'preparing' ? 'bg-orange-50 border-orange-200 text-orange-800' :
                                                                order.status === 'ready' ? 'bg-green-50 border-green-200 text-green-800' :
                                                                order.status === 'delivered' ? 'bg-gray-50 border-gray-200 text-gray-800' :
                                                                'bg-red-50 border-red-200 text-red-800'
                                                            }`
                                                        },
                                                            React.createElement('option', { value: 'pending' }, 'Pending'),
                                                            React.createElement('option', { value: 'confirmed' }, 'Confirmed'),
                                                            React.createElement('option', { value: 'preparing' }, 'Preparing'),
                                                            React.createElement('option', { value: 'ready' }, 'Ready'),
                                                            React.createElement('option', { value: 'delivered' }, 'Delivered'),
                                                            React.createElement('option', { value: 'cancelled' }, 'Cancelled')
                                                        )
                                                    )
                                                ),
                                                React.createElement('div', { className: 'mt-3' },
                                                    React.createElement('h4', { 
                                                        className: 'text-sm font-medium mb-2' 
                                                    }, 'Items:'),
                                                    React.createElement('div', { className: 'text-sm text-gray-600' },
                                                        order.items?.map((item, index) =>
                                                            React.createElement('span', { key: index },
                                                                `${item.name} x${item.quantity}`,
                                                                index < order.items.length - 1 ? ', ' : ''
                                                            )
                                                        ) || 'No items'
                                                    ),
                                                    order.specialInstructions && React.createElement('div', { 
                                                        className: 'mt-2 text-sm' 
                                                    },
                                                        React.createElement('strong', null, 'Note: '),
                                                        order.specialInstructions
                                                    )
                                                )
                                            )
                                        )
                                    )
                            )
                        ) :

                        activeTab === 'categories' ?
                        // Categories Tab
                        CategoryManagement ? React.createElement(CategoryManagement, {
                            firebaseService: firebaseService,
                            onCategoriesChange: handleCategoriesChange
                        }) :
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-sm' },
                            React.createElement('div', { className: 'p-6' },
                                React.createElement('div', { className: 'text-center py-12' },
                                    React.createElement('div', { className: 'text-6xl mb-4' }, '🏗️'),
                                    React.createElement('h3', { className: 'text-xl font-semibold text-gray-800 mb-2' }, 'Categories Management'),
                                    React.createElement('p', { className: 'text-gray-600 mb-6' }, 'Category management component not loaded. Please check category-management.js file.'),
                                    React.createElement('a', {
                                        href: 'https://console.firebase.google.com',
                                        target: '_blank',
                                        className: 'bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 inline-block'
                                    }, 'Open Firebase Console')
                                )
                            )
                        ) :

                        null
                ),

                // Add/Edit Form Modal
                (showAddForm || editingItem) && React.createElement(MenuItemForm, {
                    item: editingItem,
                    onSubmit: editingItem ? 
                        (updates) => handleUpdateItem(editingItem.id, updates) : 
                        handleAddItem,
                    onClose: () => {
                        setShowAddForm(false);
                        setEditingItem(null);
                    }
                })
            );
        };

        // Render the app
        ReactDOM.render(React.createElement(AdminPanel), document.getElementById('root'));
    </script>
</body>
</html>