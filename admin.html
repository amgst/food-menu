<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MenuCraft Admin - Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Load dependencies -->
    <script src="config/firebase-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/firebase-service.js"></script>
    <script src="js/components/shared-components.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { getTenantInfo, DEFAULT_CATEGORIES, formatCurrency, formatDate, EmptyState, LoadingSpinner, ErrorMessage, Icons } = window.MenuCraftUtils;
        const { MenuItemForm } = window.MenuCraftComponents;

        // Admin Panel Component
        const AdminPanel = () => {
            const [tenantInfo, setTenantInfo] = useState(null);
            const [firebaseService, setFirebaseService] = useState(null);
            const [menuItems, setMenuItems] = useState([]);
            const [orders, setOrders] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [activeTab, setActiveTab] = useState('menu');

            // Initialize
            useEffect(() => {
                const tenant = getTenantInfo();
                setTenantInfo(tenant);
                setFirebaseService(new window.FirebaseService(tenant.tenantId));
            }, []);

            // Load data
            useEffect(() => {
                if (firebaseService) {
                    loadData();
                }
            }, [firebaseService]);

            const loadData = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    const [itemsData, ordersData] = await Promise.all([
                        firebaseService.getMenuItems(),
                        firebaseService.getOrders(20)
                    ]);
                    setMenuItems(itemsData);
                    setOrders(ordersData);
                } catch (error) {
                    console.error('Error loading data:', error);
                    setError('Failed to load data. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const handleAddItem = async (itemData) => {
                try {
                    await firebaseService.addMenuItem(itemData);
                    setShowAddForm(false);
                    await loadData();
                } catch (error) {
                    console.error('Error adding item:', error);
                    throw error;
                }
            };

            const handleUpdateItem = async (id, updates) => {
                try {
                    await firebaseService.updateMenuItem(id, updates);
                    setEditingItem(null);
                    await loadData();
                } catch (error) {
                    console.error('Error updating item:', error);
                    throw error;
                }
            };

            const handleDeleteItem = async (id) => {
                if (confirm('Are you sure you want to delete this item?')) {
                    try {
                        await firebaseService.deleteMenuItem(id);
                        await loadData();
                    } catch (error) {
                        console.error('Error deleting item:', error);
                        alert('Error deleting item. Please try again.');
                    }
                }
            };

            const toggleStock = async (item) => {
                try {
                    await firebaseService.toggleItemStock(item.id, !item.inStock);
                    await loadData();
                } catch (error) {
                    console.error('Error toggling stock:', error);
                    alert('Error updating stock status. Please try again.');
                }
            };

            const updateOrderStatus = async (orderId, status) => {
                try {
                    await firebaseService.updateOrderStatus(orderId, status);
                    await loadData();
                } catch (error) {
                    console.error('Error updating order status:', error);
                    alert('Error updating order status. Please try again.');
                }
            };

            if (loading) {
                return React.createElement('div', { 
                    className: 'min-h-screen flex items-center justify-center bg-gray-100' 
                },
                    React.createElement('div', { className: 'text-center' },
                        React.createElement(LoadingSpinner, { size: 48 }),
                        React.createElement('p', { className: 'text-gray-600 mt-4' }, 'Loading admin dashboard...')
                    )
                );
            }

            return React.createElement('div', { className: 'min-h-screen bg-gray-100' },
                // Header
                React.createElement('div', { className: 'bg-white shadow-sm' },
                    React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-6' },
                        React.createElement('div', { className: 'flex flex-col md:flex-row justify-between items-start md:items-center gap-4' },
                            React.createElement('div', null,
                                React.createElement('h1', { className: 'text-3xl font-bold text-gray-800' }, 'MenuCraft Admin'),
                                React.createElement('p', { className: 'text-gray-600' }, 
                                    `Managing: ${tenantInfo?.displayName || 'Restaurant'}`
                                )
                            ),
                            React.createElement('div', { className: 'flex gap-3' },
                                React.createElement('a', {
                                    href: 'index.html',
                                    className: 'bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors'
                                }, 'View Menu'),
                                React.createElement('button', {
                                    onClick: () => setShowAddForm(true),
                                    className: 'bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors'
                                }, '+ Add Menu Item')
                            )
                        )
                    )
                ),

                // Navigation Tabs
                React.createElement('div', { className: 'bg-white border-b' },
                    React.createElement('div', { className: 'max-w-7xl mx-auto px-4' },
                        React.createElement('div', { className: 'flex space-x-8' },
                            React.createElement('button', {
                                onClick: () => setActiveTab('menu'),
                                className: `py-4 px-1 border-b-2 font-medium text-sm ${
                                    activeTab === 'menu' 
                                        ? 'border-orange-500 text-orange-600' 
                                        : 'border-transparent text-gray-500 hover:text-gray-700'
                                }`
                            }, `Menu Items (${menuItems.length})`),
                        React.createElement('button', {
                            onClick: () => setActiveTab('orders'),
                            className: `py-4 px-1 border-b-2 font-medium text-sm ${
                                activeTab === 'orders' 
                                    ? 'border-orange-500 text-orange-600' 
                                    : 'border-transparent text-gray-500 hover:text-gray-700'
                            }`
                        }, `Recent Orders (${orders.length})`),
                        React.createElement('button', {
                            onClick: () => setActiveTab('categories'),
                            className: `py-4 px-1 border-b-2 font-medium text-sm ${
                                activeTab === 'categories' 
                                    ? 'border-orange-500 text-orange-600' 
                                    : 'border-transparent text-gray-500 hover:text-gray-700'
                            }`
                        }, 'Categories')
                        )
                    )
                ),

                // Main Content
                React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-6' },
                    error ? React.createElement(ErrorMessage, {
                        message: error,
                        onRetry: loadData
                    }) :

                    activeTab === 'menu' ? 
                        // Menu Items Tab
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-sm' },
                            React.createElement('div', { className: 'p-6' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                    React.createElement('h2', { className: 'text-xl font-semibold' }, 'Menu Items'),
                                    React.createElement('span', { className: 'text-gray-500' }, 
                                        `${menuItems.length} total items`
                                    )
                                ),
                                
                                menuItems.length === 0 ? 
                                    React.createElement(EmptyState, {
                                        title: 'No Menu Items',
                                        message: 'Start building your menu by adding your first item.',
                                        actionText: 'Add First Item',
                                        onAction: () => setShowAddForm(true)
                                    }) :
                                    React.createElement('div', { className: 'overflow-x-auto' },
                                        React.createElement('table', { className: 'w-full' },
                                            React.createElement('thead', null,
                                                React.createElement('tr', { className: 'border-b' },
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Item'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Category'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Price'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Status'),
                                                    React.createElement('th', { className: 'text-left py-3 px-4 font-medium' }, 'Actions')
                                                )
                                            ),
                                            React.createElement('tbody', null,
                                                menuItems.map(item =>
                                                    React.createElement('tr', { 
                                                        key: item.id, 
                                                        className: 'border-b hover:bg-gray-50' 
                                                    },
                                                        React.createElement('td', { className: 'py-4 px-4' },
                                                            React.createElement('div', null,
                                                                React.createElement('div', { 
                                                                    className: 'font-medium flex items-center gap-2' 
                                                                }, 
                                                                    item.name,
                                                                    item.vegetarian && React.createElement('span', { 
                                                                        className: 'text-green-600' 
                                                                    }, '🌱'),
                                                                    item.spicy && React.createElement('span', { 
                                                                        className: 'text-red-600' 
                                                                    }, '🌶️')
                                                                ),
                                                                React.createElement('div', { 
                                                                    className: 'text-sm text-gray-500 truncate max-w-xs' 
                                                                }, item.description)
                                                            )
                                                        ),
                                                        React.createElement('td', { 
                                                            className: 'py-4 px-4 capitalize' 
                                                        }, 
                                                            DEFAULT_CATEGORIES.find(cat => cat.id === item.category)?.name || item.category
                                                        ),
                                                        React.createElement('td', { 
                                                            className: 'py-4 px-4 font-medium' 
                                                        }, formatCurrency(item.price)),
                                                        React.createElement('td', { className: 'py-4 px-4' },
                                                            React.createElement('button', {
                                                                onClick: () => toggleStock(item),
                                                                className: `px-3 py-1 rounded-full text-xs font-medium ${
                                                                    item.inStock 
                                                                        ? 'bg-green-100 text-green-800 hover:bg-green-200' 
                                                                        : 'bg-red-100 text-red-800 hover:bg-red-200'
                                                                }`
                                                            }, item.inStock ? 'In Stock' : 'Out of Stock')
                                                        ),
                                                        React.createElement('td', { className: 'py-4 px-4' },
                                                            React.createElement('div', { className: 'flex gap-2' },
                                                                React.createElement('button', {
                                                                    onClick: () => setEditingItem(item),
                                                                    className: 'text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-100 rounded',
                                                                    title: 'Edit item'
                                                                }, React.createElement(Icons.Edit, { size: 16 })),
                                                                React.createElement('button', {
                                                                    onClick: () => handleDeleteItem(item.id),
                                                                    className: 'text-red-600 hover:text-red-800 p-1 hover:bg-red-100 rounded',
                                                                    title: 'Delete item'
                                                                }, React.createElement(Icons.Trash2, { size: 16 }))
                                                            )
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                            )
                        ) :

                        // Orders Tab
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-sm' },
                            React.createElement('div', { className: 'p-6' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                    React.createElement('h2', { className: 'text-xl font-semibold' }, 'Recent Orders'),
                                    React.createElement('span', { className: 'text-gray-500' }, 
                                        `${orders.length} recent orders`
                                    )
                                ),
                                
                                orders.length === 0 ? 
                                    React.createElement(EmptyState, {
                                        title: 'No Orders Yet',
                                        message: 'Orders will appear here when customers start placing them.',
                                        actionText: null,
                                        onAction: null
                                    }) :
                                    React.createElement('div', { className: 'space-y-4' },
                                        orders.map(order =>
                                            React.createElement('div', {
                                                key: order.id,
                                                className: 'border rounded-lg p-4 hover:shadow-md transition-shadow'
                                            },
                                                React.createElement('div', { 
                                                    className: 'flex justify-between items-start mb-3' 
                                                },
                                                    React.createElement('div', null,
                                                        React.createElement('h3', { 
                                                            className: 'font-semibold' 
                                                        }, order.orderNumber || order.id),
                                                        React.createElement('p', { 
                                                            className: 'text-sm text-gray-600' 
                                                        }, order.customerInfo?.name),
                                                        React.createElement('p', { 
                                                            className: 'text-xs text-gray-500' 
                                                        }, formatDate(order.createdAt))
                                                    ),
                                                    React.createElement('div', { className: 'text-right' },
                                                        React.createElement('div', { 
                                                            className: 'font-semibold text-lg' 
                                                        }, formatCurrency(order.total)),
                                                        React.createElement('select', {
                                                            value: order.status,
                                                            onChange: (e) => updateOrderStatus(order.id, e.target.value),
                                                            className: `text-xs px-2 py-1 rounded border ${
                                                                order.status === 'pending' ? 'bg-yellow-50 border-yellow-200 text-yellow-800' :
                                                                order.status === 'confirmed' ? 'bg-blue-50 border-blue-200 text-blue-800' :
                                                                order.status === 'preparing' ? 'bg-orange-50 border-orange-200 text-orange-800' :
                                                                order.status === 'ready' ? 'bg-green-50 border-green-200 text-green-800' :
                                                                order.status === 'delivered' ? 'bg-gray-50 border-gray-200 text-gray-800' :
                                                                'bg-red-50 border-red-200 text-red-800'
                                                            }`
                                                        },
                                                            React.createElement('option', { value: 'pending' }, 'Pending'),
                                                            React.createElement('option', { value: 'confirmed' }, 'Confirmed'),
                                                            React.createElement('option', { value: 'preparing' }, 'Preparing'),
                                                            React.createElement('option', { value: 'ready' }, 'Ready'),
                                                            React.createElement('option', { value: 'delivered' }, 'Delivered'),
                                                            React.createElement('option', { value: 'cancelled' }, 'Cancelled')
                                                        )
                                                    )
                                                ),
                                                React.createElement('div', { className: 'mt-3' },
                                                    React.createElement('h4', { 
                                                        className: 'text-sm font-medium mb-2' 
                                                    }, 'Items:'),
                                                    React.createElement('div', { className: 'text-sm text-gray-600' },
                                                        order.items?.map((item, index) =>
                                                            React.createElement('span', { key: index },
                                                                `${item.name} x${item.quantity}`,
                                                                index < order.items.length - 1 ? ', ' : ''
                                                            )
                                                        ) || 'No items'
                                                    ),
                                                    order.specialInstructions && React.createElement('div', { 
                                                        className: 'mt-2 text-sm' 
                                                    },
                                                        React.createElement('strong', null, 'Note: '),
                                                        order.specialInstructions
                                                    )
                                                )
                                            )
                                        )
                                    )
                            )
                        )
                ),

                // Add/Edit Form Modal
                (showAddForm || editingItem) && React.createElement(MenuItemForm, {
                    item: editingItem,
                    onSubmit: editingItem ? 
                        (updates) => handleUpdateItem(editingItem.id, updates) : 
                        handleAddItem,
                    onClose: () => {
                        setShowAddForm(false);
                        setEditingItem(null);
                    }
                })
            );
        };

        // Render the app
        ReactDOM.render(React.createElement(AdminPanel), document.getElementById('root'));
    </script>
</body>
</html>